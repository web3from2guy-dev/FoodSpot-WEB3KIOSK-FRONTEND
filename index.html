<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Shop & Collectibles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .scrollable-content {
            height: calc(100vh - 120px); /* Adjust based on header/footer size */
            overflow-y: auto;
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #d1d5db #f3f4f6; /* Firefox */
        }

        .scrollable-content::-webkit-scrollbar {
            width: 8px;
        }

        .scrollable-content::-webkit-scrollbar-track {
            background: #f3f4f6;
            border-radius: 10px;
        }

        .scrollable-content::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 10px;
            border: 2px solid #f3f4f6;
        }

        /* Basic styling for the order status */
        .status-pending {
            color: #f59e0b; /* Amber */
            font-weight: bold;
        }
        .status-completed {
            color: #10b981; /* Emerald */
            font-weight: bold;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center p-4">

    <div id="welcome-page" class="flex flex-col items-center justify-center min-h-screen transition-opacity duration-500 ease-in-out">
        <div class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full text-center">
            <h1 class="text-5xl font-extrabold text-gray-800 mb-4">Welcome</h1>
            <p class="text-xl text-gray-600 mb-8">Discover a world of unique gifts and cherished collectibles.</p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button id="connect-wallet-btn" class="px-8 py-4 bg-purple-600 text-white font-semibold text-lg rounded-full shadow-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50">
                    Connect Wallet
                </button>
                <button id="enter-shop-btn" class="px-8 py-4 bg-purple-600 text-white font-semibold text-lg rounded-full shadow-lg hover:bg-purple-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500 focus:ring-opacity-50 hidden">
                    Enter the Shop
                </button>
                <button id="admin-login-btn" class="px-8 py-4 bg-gray-600 text-white font-semibold text-lg rounded-full shadow-lg hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-500 focus:ring-opacity-50">
                    Admin Login
                </button>
            </div>
        </div>
    </div>

    <div id="storefront-page" class="hidden w-full max-w-6xl transition-opacity duration-500 ease-in-out flex flex-col">

        <header class="w-full bg-white p-6 rounded-2xl shadow-xl text-center mb-6">
            <h2 class="text-4xl font-extrabold text-gray-800">Our Collections</h2>
            <p class="text-lg text-gray-500 mt-2">All products in one place. No categories, just pure discovery.</p>
            <p id="account-info" class="text-sm text-gray-500 mt-2 hidden">Connected: <span id="wallet-address"></span></p>
            <button id="back-to-welcome-from-store" class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-full hover:bg-gray-300 transition-colors duration-200 focus:outline-none">
                Back to Welcome
            </button>
        </header>

        <div class="scrollable-content w-full bg-white p-6 rounded-2xl shadow-xl">
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                </div>
        </div>

        <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t-2 border-gray-200 shadow-xl flex flex-col sm:flex-row items-center justify-between z-10 rounded-t-2xl">
            <div id="cart-summary" class="flex-grow text-center sm:text-left text-gray-700 mb-4 sm:mb-0">
                <span class="font-semibold text-lg" id="cart-item-count">Your Cart: 0 items</span>
                <span class="font-bold text-xl ml-4" id="cart-total">Total: $0.00</span>
            </div>
            <button id="checkout-btn" class="px-6 py-3 bg-green-500 text-white font-bold rounded-full shadow-md hover:bg-green-600 transition-colors duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-400 focus:ring-opacity-50">
                Proceed to Checkout
            </button>
        </div>
    </div>

    <div id="admin-login-page" class="hidden flex-col items-center justify-center min-h-screen transition-opacity duration-500 ease-in-out">
        <div class="bg-white p-8 rounded-2xl shadow-xl max-w-md w-full text-center">
            <h2 class="text-3xl font-bold text-gray-800 mb-6">Admin Login</h2>
            <input type="password" id="admin-password-input" placeholder="Enter Admin Password" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <p id="admin-login-error" class="text-red-500 text-sm mb-4 hidden">Incorrect password. Please try again.</p>
            <button id="login-btn" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-md hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                Login
            </button>
            <button id="back-to-welcome-from-admin-login" class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-full hover:bg-gray-300 transition-colors duration-200 focus:outline-none">
                Back to Welcome
            </button>
        </div>
    </div>

    <div id="admin-dashboard-page" class="hidden w-full max-w-6xl transition-opacity duration-500 ease-in-out flex flex-col">
        <header class="w-full bg-white p-6 rounded-2xl shadow-xl text-center mb-6">
            <h2 class="text-4xl font-extrabold text-gray-800">Order Management</h2>
            <p class="text-lg text-gray-500 mt-2">Track and manage all customer orders.</p>
            <button id="back-to-welcome-from-admin-dashboard" class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-full hover:bg-gray-300 transition-colors duration-200 focus:outline-none">
                Back to Welcome
            </button>
        </header>

        <div class="scrollable-content w-full bg-white p-6 rounded-2xl shadow-xl">
            <div id="orders-list" class="space-y-4">
                <p class="text-gray-500 text-center" id="no-orders-message">No orders yet.</p>
            </div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-20">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-md w-full text-center transform scale-95 transition-all duration-300 ease-out">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Order Confirmed!</h3>
            <p class="text-gray-600 mb-6">
                Your order is complete. To pay, please use the following unique order ID with your Cash App transaction.
            </p>
            <div class="bg-gray-100 p-4 rounded-xl flex items-center justify-between mb-6">
                <p id="order-text" class="text-lg font-mono text-gray-800 break-all mr-4"></p>
                <button id="copy-btn" class="flex-shrink-0 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    Copy
                </button>
            </div>
            <p class="text-sm text-gray-500">Make sure this ID is in the transaction note.</p>
            <button id="close-modal-btn" class="mt-6 px-6 py-3 bg-gray-200 text-gray-800 font-semibold rounded-full hover:bg-gray-300 transition-colors duration-200 focus:outline-none">
                Close
            </button>
        </div>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Use an IIFE (Immediately Invoked Function Expression) to avoid global variables
        (function() {
            // --- Global Variables for Firebase (MANDATORY) ---
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

            // --- Firebase Initialization ---
            let app, db, auth, userId;
            let isAuthReady = false;

            async function initializeFirebase() {
                try {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);

                    // Sign in with custom token if available, otherwise anonymously
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }

                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            userId = user.uid;
                            console.log("Firebase Auth Ready. User ID:", userId);
                            isAuthReady = true;
                            // Start listening to orders if admin dashboard is active
                            if (!adminDashboardPage.classList.contains('hidden')) {
                                setupOrderListener();
                            }
                        } else {
                            console.log("No user signed in.");
                            isAuthReady = false;
                        }
                    });
                } catch (error) {
                    console.error("Error initializing Firebase:", error);
                    // Handle error, e.g., show a message to the user
                }
            }
            
            // --- Web3 State Variables ---
            let provider;
            let signer;
            let currentAddress;
            const targetPolygonAddress = "0x..."; // **REPLACE WITH YOUR WALLET ADDRESS**

            // --- DOM Element References ---
            const welcomePage = document.getElementById('welcome-page');
            const storefrontPage = document.getElementById('storefront-page');
            const connectWalletBtn = document.getElementById('connect-wallet-btn');
            const enterShopBtn = document.getElementById('enter-shop-btn');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const productGrid = document.getElementById('product-grid');
            const checkoutBtn = document.getElementById('checkout-btn');
            const modal = document.getElementById('modal');
            const orderTextElement = document.getElementById('order-text');
            const copyBtn = document.getElementById('copy-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const cartItemCount = document.getElementById('cart-item-count');
            const cartTotal = document.getElementById('cart-total');
            const walletAddressSpan = document.getElementById('wallet-address');
            const accountInfoElement = document.getElementById('account-info');

            const adminLoginPage = document.getElementById('admin-login-page');
            const adminPasswordInput = document.getElementById('admin-password-input');
            const loginBtn = document.getElementById('login-btn');
            const adminLoginError = document.getElementById('admin-login-error');

            const adminDashboardPage = document.getElementById('admin-dashboard-page');
            const ordersList = document.getElementById('orders-list');
            const noOrdersMessage = document.getElementById('no-orders-message');

            const backToWelcomeFromStore = document.getElementById('back-to-welcome-from-store');
            const backToWelcomeFromAdminLogin = document.getElementById('back-to-welcome-from-admin-login');
            const backToWelcomeFromAdminDashboard = document.getElementById('back-to-welcome-from-admin-dashboard');

            // --- State Management ---
            let cart = [];
            const ADMIN_PASSWORD = "memphisfoodhead"; // Default admin password
            const products = [
                { id: 'prod-001', name: 'Vintage Space Robot', price: 49.99, image: 'https://placehold.co/400x300/e5e7eb/6b7280?text=Robot' },
                { id: 'prod-002', name: 'Mystic Crystal Ball', price: 29.50, image: 'https://placehold.co/400x300/d1d5db/4b5563?text=Crystal+Ball' },
                { id: 'prod-003', name: 'Golden Treasure Coin', price: 15.00, image: 'https://placehold.co/400x300/9ca3af/374151?text=Gold+Coin' },
                { id: 'prod-004', name: 'Pocket Dragon Figurine', price: 22.75, image: 'https://placehold.co/400x300/a5b4fc/1f2937?text=Dragon' },
                { id: 'prod-005', name: 'Hand-Carved Wooden Bear', price: 35.00, image: 'https://placehold.co/400x300/bfdbfe/1e3a8a?text=Wooden+Bear' },
                { id: 'prod-006', name: 'Starlight Jar', price: 18.99, image: 'https://placehold.co/400x300/c7d2fe/3730a3?text=Star+Jar' },
                { id: 'prod-007', name: 'Miniature Globe', price: 25.00, image: 'https://placehold.co/400x300/dbeafe/1e40af?text=Globe' },
                { id: 'prod-008', name: 'Rare Comic Book', price: 99.99, image: 'https://placehold.co/400x300/c4b5fd/4338ca?text=Comic+Book' }
            ];

            // --- Utility Functions ---
            function showPage(pageElement) {
                welcomePage.classList.add('hidden');
                storefrontPage.classList.add('hidden');
                adminLoginPage.classList.add('hidden');
                adminDashboardPage.classList.add('hidden');

                welcomePage.classList.remove('flex');
                storefrontPage.classList.remove('flex');
                adminLoginPage.classList.remove('flex');
                adminDashboardPage.classList.remove('flex');

                pageElement.classList.remove('hidden');
                pageElement.classList.add('flex');
            }

            // --- Function to Render Products ---
            function renderProducts() {
                productGrid.innerHTML = ''; // Clear previous products
                products.forEach(product => {
                    const productCard = document.createElement('div');
                    productCard.className = 'bg-gray-50 rounded-2xl shadow-md overflow-hidden p-4 flex flex-col justify-between transform hover:scale-105 transition-transform duration-300';
                    productCard.innerHTML = `
                        <img src="${product.image}" alt="${product.name}" class="w-full h-auto rounded-lg mb-4">
                        <div>
                            <h4 class="text-xl font-bold text-gray-800 mb-1">${product.name}</h4>
                            <p class="text-lg font-semibold text-gray-600 mb-4">$${product.price.toFixed(2)}</p>
                            <button data-product-id="${product.id}" class="add-to-cart-btn w-full py-2 bg-blue-500 text-white font-semibold rounded-full shadow-md hover:bg-blue-600 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-blue-400 focus:ring-opacity-50">
                                Add to Cart
                            </button>
                        </div>
                    `;
                    productGrid.appendChild(productCard);
                });
            }

            // --- Function to Update Cart Display ---
            function updateCart() {
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                cartItemCount.textContent = `Your Cart: ${cart.length} item${cart.length === 1 ? '' : 's'}`;
                cartTotal.textContent = `Total: $${total.toFixed(2)}`;
                checkoutBtn.disabled = cart.length === 0; // Disable checkout if cart is empty
                if (cart.length === 0) {
                    checkoutBtn.classList.add('bg-gray-400', 'hover:bg-gray-400');
                    checkoutBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                } else {
                    checkoutBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                    checkoutBtn.classList.remove('bg-gray-400', 'hover:bg-gray-400');
                }
            }

            // --- Firestore Functions ---
            async function saveOrder(orderData) {
                if (!isAuthReady) {
                    console.error("Firebase not ready. Cannot save order.");
                    return;
                }
                try {
                    const ordersCollectionRef = collection(db, `artifacts/${appId}/public/data/giftShopOrders`);
                    await addDoc(ordersCollectionRef, orderData);
                    console.log("Order saved successfully!");
                } catch (e) {
                    console.error("Error adding document: ", e);
                }
            }

            function setupOrderListener() {
                if (!isAuthReady) {
                    console.error("Firebase not ready. Cannot set up order listener.");
                    return;
                }
                const ordersCollectionRef = collection(db, `artifacts/${appId}/public/data/giftShopOrders`);
                // Note: orderBy() is avoided as per instructions to prevent index issues.
                // Data will be sorted in memory if needed.
                onSnapshot(ordersCollectionRef, (snapshot) => {
                    ordersList.innerHTML = ''; // Clear current list
                    if (snapshot.empty) {
                        noOrdersMessage.classList.remove('hidden');
                    } else {
                        noOrdersMessage.classList.add('hidden');
                        snapshot.forEach(doc => {
                            const order = doc.data();
                            const orderId = doc.id; // Firestore document ID
                            const orderCard = document.createElement('div');
                            orderCard.className = 'bg-gray-50 p-4 rounded-xl shadow-sm border border-gray-200';
                            let itemsHtml = order.items.map(item => `<li>${item.name} ($${item.price.toFixed(2)})</li>`).join('');

                            orderCard.innerHTML = `
                                <div class="flex justify-between items-center mb-2">
                                    <h4 class="text-lg font-bold text-gray-800">Order ID: <span class="font-mono text-sm text-gray-600">${order.orderId || orderId}</span></h4>
                                    <span class="text-sm text-gray-500">${new Date(order.timestamp).toLocaleString()}</span>
                                </div>
                                <p class="text-gray-700 mb-2">Total: <span class="font-bold text-lg">$${order.total.toFixed(2)}</span></p>
                                <p class="text-gray-700 mb-2">Status: <span class="${order.status === 'Pending Payment' ? 'status-pending' : 'status-completed'}">${order.status}</span></p>
                                <p class="text-gray-700">Items:</p>
                                <ul class="list-disc list-inside text-gray-600 text-sm mb-3">
                                    ${itemsHtml}
                                </ul>
                                <button data-order-id="${orderId}" data-current-status="${order.status}" class="mark-as-paid-btn px-4 py-2 bg-indigo-500 text-white text-sm rounded-full hover:bg-indigo-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-400 ${order.status === 'Completed' ? 'opacity-50 cursor-not-allowed' : ''}" ${order.status === 'Completed' ? 'disabled' : ''}>
                                    ${order.status === 'Completed' ? 'Paid' : 'Mark as Paid'}
                                </button>
                            `;
                            ordersList.appendChild(orderCard);
                        });
                    }
                }, (error) => {
                    console.error("Error listening to orders:", error);
                });
            }

            async function updateOrderStatus(orderDocId, newStatus) {
                if (!isAuthReady) {
                    console.error("Firebase not ready. Cannot update order status.");
                    return;
                }
                try {
                    const orderRef = doc(db, `artifacts/${appId}/public/data/giftShopOrders`, orderDocId);
                    await updateDoc(orderRef, { status: newStatus });
                    console.log(`Order ${orderDocId} status updated to ${newStatus}`);
                } catch (e) {
                    console.error("Error updating document: ", e);
                }
            }


            // --- Web3 Functionality ---
            async function connectWallet() {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        // Request account access
                        await window.ethereum.request({ method: 'eth_requestAccounts' });
                        provider = new ethers.providers.Web3Provider(window.ethereum);
                        signer = provider.getSigner();
                        currentAddress = await signer.getAddress();
                        walletAddressSpan.textContent = `${currentAddress.substring(0, 6)}...${currentAddress.substring(currentAddress.length - 4)}`;
                        accountInfoElement.classList.remove('hidden');
                        
                        connectWalletBtn.classList.add('hidden');
                        enterShopBtn.classList.remove('hidden');

                        console.log("Wallet connected:", currentAddress);
                    } catch (error) {
                        console.error("User rejected wallet connection:", error);
                    }
                } else {
                    alert("Please install a Web3 wallet like MetaMask to use this feature.");
                }
            }

            async function sendMatic(toAddress, amountInUSD) {
                if (!signer) {
                    alert("Please connect your wallet first.");
                    return;
                }
                
                try {
                    // In a real-world scenario, you would need to get the current MATIC to USD exchange rate
                    // For this example, we'll use a fixed conversion factor
                    const maticPrice = 0.50; // Example: 1 MATIC = $0.50
                    const amountInMatic = amountInUSD / maticPrice;

                    // Convert the amount to Wei (the smallest unit of MATIC)
                    const amountInWei = ethers.utils.parseEther(amountInMatic.toString());

                    // Create the transaction
                    const tx = {
                        to: toAddress,
                        value: amountInWei
                    };

                    // Send the transaction and wait for the hash
                    const txResponse = await signer.sendTransaction(tx);
                    console.log("Transaction sent:", txResponse.hash);
                    
                    // You can wait for the transaction to be mined for confirmation
                    // await txResponse.wait();
                    // console.log("Transaction confirmed!");
                    return txResponse.hash;

                } catch (error) {
                    console.error("Error sending transaction:", error);
                    return null;
                }
            }


            // --- Event Listeners ---
            connectWalletBtn.addEventListener('click', connectWallet);
            
            enterShopBtn.addEventListener('click', () => {
                showPage(storefrontPage);
                renderProducts(); // Render products once the storefront is visible
                updateCart(); // Initial cart state
            });

            adminLoginBtn.addEventListener('click', () => {
                showPage(adminLoginPage);
                adminPasswordInput.value = ''; // Clear password field
                adminLoginError.classList.add('hidden'); // Hide error message
            });

            loginBtn.addEventListener('click', () => {
                const enteredPassword = adminPasswordInput.value;
                if (enteredPassword === ADMIN_PASSWORD) {
                    showPage(adminDashboardPage);
                    setupOrderListener(); // Start listening to orders when admin logs in
                } else {
                    adminLoginError.classList.remove('hidden');
                }
            });

            backToWelcomeFromStore.addEventListener('click', () => {
                showPage(welcomePage);
            });

            backToWelcomeFromAdminLogin.addEventListener('click', () => {
                showPage(welcomePage);
            });

            backToWelcomeFromAdminDashboard.addEventListener('click', () => {
                showPage(welcomePage);
            });


            productGrid.addEventListener('click', (event) => {
                if (event.target.classList.contains('add-to-cart-btn')) {
                    const productId = event.target.dataset.productId;
                    const productToAdd = products.find(p => p.id === productId);
                    if (productToAdd) {
                        cart.push(productToAdd);
                        updateCart();
                    }
                }
            });

            checkoutBtn.addEventListener('click', async () => {
                if (cart.length === 0) {
                    return;
                }

                if (!currentAddress) {
                    alert("Please connect your wallet to checkout.");
                    return;
                }

                const totalAmount = cart.reduce((sum, item) => sum + item.price, 0);

                const txHash = await sendMatic(targetPolygonAddress, totalAmount);
                
                if (txHash) {
                     const orderId = `order_${crypto.randomUUID()}`;
                     const orderData = {
                        orderId: orderId,
                        items: cart.map(item => ({ id: item.id, name: item.name, price: item.price })),
                        total: totalAmount,
                        timestamp: new Date().toISOString(),
                        status: 'Pending Payment', // Initial status
                        cryptoTransactionHash: txHash, // Store the transaction hash
                        customerWallet: currentAddress
                    };
                    await saveOrder(orderData); // Save order to Firestore

                    orderTextElement.textContent = orderId;
                    modal.classList.remove('hidden');
                } else {
                    alert("Crypto payment failed. Please try again.");
                }

            });

            copyBtn.addEventListener('click', () => {
                const orderId = orderTextElement.textContent;
                const tempInput = document.createElement('textarea');
                tempInput.value = orderId;
                document.body.appendChild(tempInput);
                tempInput.select();
                try {
                    document.execCommand('copy');
                    copyBtn.textContent = 'Copied!';
                    copyBtn.classList.add('bg-gray-500', 'hover:bg-gray-500');
                    copyBtn.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                    setTimeout(() => {
                        copyBtn.textContent = 'Copy';
                        copyBtn.classList.remove('bg-gray-500', 'hover:bg-gray-500');
                        copyBtn.classList.add('bg-purple-600', 'hover:bg-purple-700');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                } finally {
                    document.body.removeChild(tempInput);
                }
            });

            closeModalBtn.addEventListener('click', () => {
                modal.classList.add('hidden');
                cart = []; // Reset cart for a new transaction
                updateCart();
            });

            // Event listener for marking orders as paid in admin dashboard
            ordersList.addEventListener('click', (event) => {
                if (event.target.classList.contains('mark-as-paid-btn')) {
                    const orderDocId = event.target.dataset.orderId;
                    const currentStatus = event.target.dataset.currentStatus;
                    if (currentStatus !== 'Completed') {
                        updateOrderStatus(orderDocId, 'Completed');
                    }
                }
            });

            // Initialize Firebase when the script loads
            initializeFirebase();
        })();
    </script>

</body>
</html>
